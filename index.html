<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/league.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-background-image="http://www.simplifycorp.com/images/pageimages/img_deepdive_header.jpg">
					<h1>docker networking deepdive</h1>
					<p>Created by Oded Priva</p>
				</section>
				<section about="WORKSHOP DESCRIPTIONS">
					<section data-markdown>
						<script type="text/template">
							### Workshop Descriptions
							- Docker has revolutionized virtualization by abstracting some ~15 years old Kernel tools.
							- Along the way they have been using some basic linux networking tools ( and now windows ) that enabled container networking.
							- This workshop will introduce general networking concepts, tools and docker specific networking model and its implementation.
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							### Participants Will
							1. Understand basic networking concepts by using various tools such as `tcpdump`, `ip` etc.
							2. Understand the [CNM](https://github.com/docker/libnetwork/blob/master/docs/design.md#the-container-network-model).
							3. Understand single host container networking and multi-host container networking
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							### Workshop agenda
							#### Part 1 - 90 minutes

							- linux networking:
							- Networking models.
							- NIC
							- Routing
							- iptables
							- namespace and linux bridge
							- name resolution
							- ipvs
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							### Workshop agenda
							#### Part 2 - 90 minutes

							- docker network background:
							- history
							- components
							- docker network subcommand.
							- docker network drivers:
							- bridge
							- overlay
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							### Who this workshop is for

							- This workshop is targeted at users who already know the basics of Docker and linux networking,
							That want to know how the **magic** of container networking works under-the-hood
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							### Knowledge Prerequisites
							- Participants are expected to have experience with docker.
							- Although I will try to cover all that is needed from networking POV, participants who have basic knowledge in the OSI or TCP/IP model, will find the workshop much easier to follow.
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							### Hardware Prerequisites
							- This workshop was built on MAC Sierra, with Docker 1.12 ( tested on 1.13 ).
							- Other OS ( Windows, Ubuntu etc .. ) could also benefit from both part of the Workshop but some commands will just not work.
						</script>
					</section>
				</section>
				<section about="BUILDING THE LAB">
					<section data-markdown>
						<script type="text/template">
							linux networking
							---

							### Participants Will

							- Build the `lab` that will be used throughout this workshop.
							- Refreshes and gain new knowledge on core Linux concepts that provide a foundation for 2nd part, such as TCP/IP, OSI, name resolution, `ip` command and other tools.
						</script>
					</section>
					<section data-background-image="http://online.thatsmags.com/uploads/content/1404/3615/breaking-bad-lab.jpg">
						<h1>let't build the lab</h1>
					</section>
					<section data-markdown>
						<script type="text/template">
							CLONE ME
							``` shell
							https://github.com/odedpriva/docker-networking-workshop.git

							```
						</script>
					</section>
                    <section>
                        <h3>hands on</h3>
                        <img class="plain" src="https://docs.google.com/drawings/d/14puhXS-FOWePChsCrKhpj07ScQxbLmS6KE17hLfe8d8/pub?w=450&h=450">
                    </section>
				</section>
				<section about="NETWORKING MODELS">
					<section data-markdown>
						<script type="text/template">
							Networking models
							---

							Layers model is a theoretical approach that describe how data is going to be transmit over the network.
						</script>
					</section>
                    <section>
                        <h3>let's write a letter</h3>
                        <img class="plain" width="350" height="350" src="http://download.seaicons.com/icons/paomedia/small-n-flat/1024/envelope-letter-icon.png">
                    </section>
					<section>
						<div>
							<img class="fragment plain" width="100" data-src="images/application.png" alt="application">
							<img class="fragment plain" width="100" data-src="images/presentation.png" alt="application">
							<img class="fragment plain" width="100" data-src="images/session.png" alt="application">
							<img class="fragment plain" width="100" data-src="images/transport.png" alt="application">
							<img class="fragment plain" width="100" data-src="images/network.png" alt="application">
							<img class="fragment plain" width="100" data-src="images/datalink.png" alt="application">
							<img class="fragment plain" width="100" data-src="images/physical.png" alt="application">
						</div>
						<div class="fragment">
							<img class="plain"  width="100" data-src="images/application2.png" alt="application">
							<img class="plain"  width="100" data-src="images/presentation2.png" alt="application">
							<img class="plain"  width="100" data-src="images/session.png" alt="application">
							<img class="plain"  width="100" data-src="images/transport.png" alt="application">
							<img class="plain"  width="100" data-src="images/network.png" alt="application">
							<img class="plain" width="100" data-src="images/datalink2.png" alt="application">
							<img class="plain"  width="100" data-src="images/physical2.png" alt="application">
						</div>
                        <h4 class="fragment">
                        The Open Systems Interconnection model (OSI model), published in 1984, is a conceptual model that characterizes and standardizes the communication functions of a telecommunication or computing system without regard to their underlying internal structure and technology
                        </h4>
                        <aside class="notes">
                            1. Application -- The collection of letters exchanged: the point of the previous six layers was to enable the pen pal relationship between two people.<br>
                            2. Presentation -- The body of the letter itself: let's make sure both parties are writing in English.<br>
                            3. Session -- The standard letter format: this includes dating the letters, saying "dear so-and-so" and "yours truly."<br>
                            4. Transport -- Your name on the envelope: once it gets inside your house, it needs to be given to the correct person.  <br>
                            5. Network -- The address: the USPS needs to know where to deliver the letter. This establishes a connection between two residences. <br>
                            6. Data-link -- The envelope: you can't just put a handwritten letter in a mailbox and expect it to be sent somewhere. <br>
                            7. Physical -- The USPS' trucks, trains, and planes: this is how the letters actually get from point A to point B. <br>
                        </aside>
					</section>
                    <section>
                        <h4>
                            The TCP/IP protocol suite maps to a four-layer conceptual model known as the DARPA model, which was named after the U.S. government agency that initially developed TCP/IP
                        </h4>
                        <img class="plain" src="https://docs.google.com/drawings/d/1pBd7rglGfpw0JN_35KJT0f_N-Ef5wpLkpYrquObSbuA/pub?w=1440&h=1080">
                    </section>
                    <section>
                        <img class="plain" src="images/networking-models-1.png" border="0">
                    </section>
				</section>
                <section about="NETWORK ROUTING" >
                    <section>
                        <h3>How network routing works ? <br> OR,<br> let's send a letter.</h3>
						<img src="https://docs.google.com/drawings/d/1xWUVDkYSqAvgfHz7qn6bATnH2wuv7ITrl2Ek_55IK_c/pub?w=425&h=235" />
                    </section>
                    <section>
						<h3>
							meet Onett hills
						</h3>
						<div style="position:relative; width:857px; height:483px; margin:0 auto;">
							<img class="plain fragment" width="857" height="483" src="./images/se1.png" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment" width="857" height="483" src="./images/se2.png" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment" width="857" height="483" src="./images/se3.png" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment" width="857" height="483" src="./images/se4.png" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment" width="857" height="483" src="./images/se5.png" style="position:absolute;top:0;left:0;" />
						</div>
					</section>
					<section data-markdown>
						<script type="text/template">
							|   |                              Sending a packet                                 |
							|:-:|:------------------------------------------------------------------------------|
							| 1 | determine if the destination IP address is itself                             |
							| 2 | consults **routing table** to determine if the address is on the same network |
							| 3 | broadcast an **ARP** request                                                  |
							| 4 | responds to the **ARP** request                                               |
							| 5 | construct a Layer-2 frame, with a destination MAC address                     |
						</script>
					</section>
					<section>
						<h3>let's send another one</h3>
						<img src="https://docs.google.com/drawings/d/19Bm4TeL2fJp__7d9BWA_zbjJ6_hD7MPEjrv1zok1YdY/pub?w=425&h=235" />
					</section>
					<section>
						<h3>
                            now, lets send it to grayscale
                        </h3>
						<div style="position:relative; width:1119px; height:282px; margin:0 auto;">
							<img class="plain fragment"  width="1119" height="282" src="./images/gs1.png" alt="grayscale #1" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment"  width="1119" height="282" src="./images/gs2.png" alt="grayscale #2" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment"  width="1119" height="282" src="./images/gs3.png" alt="grayscale #3" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment"  width="1119" height="282" src="./images/gs4.png" alt="grayscale #4" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment"  width="1119" height="282" src="./images/gs5.png" alt="grayscale #5" style="position:absolute;top:0;left:0;" />
							<img class="plain fragment"  width="1119" height="282" src="./images/gs6.png" alt="grayscale #6" style="position:absolute;top:0;left:0;" />
						</div>
					</section>
					<section data-markdown>
						<script type="text/template">
							|   |                              Sending a packet to different network.           |
							|:-:|:------------------------------------------------------------------------------|
							| 1 | determine if the destination IP address is itself by consulting the **routing table** |
							| 2 | broadcast an **ARP** request for default GW MAC address |
							| 3 | sends the packet to default GW |
							| 4 | default GW parse its own routing table for a route to the destination network |
							| 5 | broadcasts an ARP request |
							| 6 | construct a Layer-2 frame, with a destination MAC address |
						</script>
					</section>
                    <section>
                        <h3>
                            <a target="_blank" href="https://github.com/odedpriva/docker-networking-workshop/tree/master/linux-networking/hands-on-1-routing">
                                routing
                            </a>
                        </h3>
                        <img class="plain" src="https://docs.google.com/drawings/d/14puhXS-FOWePChsCrKhpj07ScQxbLmS6KE17hLfe8d8/pub?w=450&h=450">
                    </section>
                </section>
                <section about="NETWORK IPTABLES" >
                    <section>
                        <h3>iptables</h3>
                        <img class="plain" src="http://i.imgur.com/000yMhS.png">
                    </section>
                    <section>
                        <h3>what if the recipient does not want to get the letter?</h3>
                        <div style="position:relative; width:927px; height:519px; margin:0 auto;">
                            <img class="plain fragment"  width="927" height="519" src="./images/ip1.png" alt="iptables #1" style="position:absolute;top:0;left:0;" />
                            <img class="plain fragment"  width="927" height="519" src="./images/ip2.png" alt="iptables #2" style="position:absolute;top:0;left:0;" />
                            <img class="plain fragment"  width="927" height="519" src="./images/ip3.png" alt="iptables #3" style="position:absolute;top:0;left:0;" />
                        </div>
                    </section>

                        <section>
                            <h4 class="center">
                                Administration tool for IPv4 packet filtering and NAT
                            </h4>
                            <img class="plain" src="https://s3.amazonaws.com/cp-s3/wp-content/uploads/2015/09/08085516/iptables-Flowchart.jpg">
                        </section>
                    <section>
                        <div style="position:relative; width:927px; height:519px; margin:0 auto;">
                        <table><thead>
                        <tr>
                            <th>Tables↓/Chains→</th>
                            <th style="text-align: center">PREROUTING</th>
                            <th style="text-align: center">INPUT</th>
                            <th style="text-align: center">FORWARD</th>
                            <th style="text-align: center">OUTPUT</th>
                            <th style="text-align: center">POSTROUTING</th>
                        </tr>
                        </thead><tbody>
                        <tr>
                            <td>(routing decision)</td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center"></td>
                        </tr>
                        <tr>
                            <td><strong>raw</strong></td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center"></td>
                        </tr>
                        <tr>
                            <td><strong>mangle</strong></td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center">✓</td>
                        </tr>
                        <tr>
                            <td><strong>nat</strong></td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center"></td>
                        </tr>
                        <tr>
                            <td><strong>filter</strong></td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center"></td>
                        </tr>
                        <tr>
                            <td><strong>nat</strong> (SNAT)</td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center">✓</td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center"></td>
                            <td style="text-align: center">✓</td>
                        </tr>
                        </tbody></table>
                        </div>
                    </section>
                        <section>
                            <h3>hands on</h3>
                            <img class="plain" src="https://docs.google.com/drawings/d/14puhXS-FOWePChsCrKhpj07ScQxbLmS6KE17hLfe8d8/pub?w=450&h=450">
                        </section>

                </section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
              controls: false,
              viewDistance: 10,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
